\documentclass{article}
\usepackage{amsmath}

\begin{document}

\author{
	\texttt{24978}
	\and
	\texttt{97395}
}
\title{Coursework 2: Group Report}
\maketitle

\section*{Task 1: Schema Design}

\subsection*{Schema}

The schema was arranged into  \texttt{Person, Forum, Topic, Post, PostLikes} and \texttt{TopicLikes}.
The tables were kept as simple as possible so that space could be optimised.
The Post belongs to a Topic, which belongs to a Forum. This arrangment meant the Post contained a foreign key to the Topic, which contained a foreign key to the Forum. This made the most sense, as a Forum has a 1 to many relation with Topic, and Topic has a one to many relationship with Post. In this way, we could keep the forum table compact with only 2 collumns.
The Topic and Post also contained a foregin key to the person who created the associated post/topic.
The Post contained a message and a timePosted variable. This was important to include as it indicated which topic was posted into most recently, which was displayed on the forum view page. It would also aid in ordering the posts in the topics, so they are in the correct order.

The PostLikes contained a foreign key to the person and the post. This is because there can be many likes to 1 post. 1 Like is also associated to 1 person.
This was likewise with the TopicLikes table.

All of the variables in the schema were defined as NOT NULL EXCEPT the StuId. This could be null depending on whether the Person was a student or not. All other variables were set to not null because they were required to be a valid input.


\subsection*{Normalisation}

The scheme as in 1NF as none of the tables contain collection valued attributes. 

The Person table has two candidate keys, id and username. As both these candidate keys contain a single attribute there cannot exist any non-trivial partial functional dependencies. The Forum table again contains two candidate keys but for the previously stated reason there cannot exist any non-trivial functional dependencies. The topic table contains only one candidate key, \texttt{id}. This is justified as none of the other parameters are guaranteed to be unique, i.e. two topics can exist with the same \texttt{title}, \texttt{message}, \texttt{forumId} and \texttt{personId}. This candidate key only contains a single attribute so again there can be no non-trivial partial functional dependencies. The same arguments can be used to deduce that the Post, PostLikes and TopicLikes tables all contain no non-trivial partial functional dependencies. Therefore, the scheme is in 2NF.



\newpage
\section*{Task 2: Method Implementation}

\subsection*{}

In general, the methods used a Prepared statement to execute queries which were set to the API connector. These queries used placholders as \texttt{xxxxx}. After the query was executed, the PrepareStatment was closed using the .close() method, and the Connection c was commited, using the .commit(). This allowed \texttt{xxxxx}. 

To handle errors, 

\subsection*{getUsers}

For this method the database is queried to return all the pairs of names and usernames in the database. These pairs are then iterated through and added to the hash map which is then returned.

\subsection*{getPersonView}

This method returned a PersonView object, which required a username, name (NOT NULL) and student ID (NULL) to create an instance. For this, a query was made which selected name and stuId based on the input username. The ResultSet checked if there was a result and filled the parameters to be inputed to the PersonView instance. Else, a failure was made that the user does not exits.

\subsection*{addNewPerson}

First, it was important to check that all the inputs were not empty, and username and name were not null. Then, an insert query was formulated which inserted each input into the appropriate collumns using setString.

\subsection*{getSimpleForums}

This method required a return List of SimpleForumSummaryView. This object required a title and an id to create an instance. An array list was created


\subsection*{createForum}

\subsection*{getForums}

This method uses a single query that retrieves the information for all forums. A complex join was required to retrieve the topic within a forum which has had a post made in it most recently. The results are then iterated through and added to the lost of ForumSummaryViews. The topicId was retrieved as a string instead of an integer. This is to deal with the case where a forum has no topics within it. If the topicId string is not null it is then converted to an integer.

\subsection*{getForum}

\subsection*{getSimpleTopic}

\subsection*{getLatestPost}

This method uses a single query to get the information needed to construct the required PostView, joins are used to get the latest post by choosing the post with the largest time posted. Joins are also used to get the number of likes the post has as well as the post number.

\subsection*{createPost}

The method first checks that the text and username given as input are not null or empty. A query is used to check that the topic with the given ID exists and another query is used to check that a person with the given username exists. The post is then inserted into the database.

\subsection*{createTopic}

This method begins by checking that the title and text arguments are not empty or null. A query is then used to retrieve the persons ID from there username. The topic is then inserted into the database. \texttt{RETURN\_GENERATED\_KEYS} is used to find the ID of the topic which has been inserted into the database. This key is then used when inserting the initial post of the topic into the Post table in the database.

\subsection*{countPostsInTopic}

\subsection*{likeTopic}

\subsection*{likePost}

The method checks that the person liking the post exists and gets the ID of this person if they exist. The existence of a topic with this ID is then checked. Then a query is done to check whether there is a database entry for this post being liked by this person. If there is and the \texttt{like} boolean is true then an error is returned as the post has already been liked. If there is and the \texttt{like} boolean is false then the entry is removed from the PostLikes table in the database. If there is no database entry, essentially the reverse is done, if \texttt{like} is true, an entry is inserted into the PostLikes table and if \texttt{like} is false then an error is returned.

\subsection*{getLikers}

\subsection*{getTopic}

This method begins by checking the existence of a topic with this ID in the database and if so retrieves the necessary information about the topic and the forum it is contained in. Another query is then used to get the posts contained within the topic, with a left outer join with the PostLikes table being used to get the number of likes each post has. The results are then iterated through and added to the list of PostViews.

\subsection*{getAdvancedPersonView}

This method required complex SQL queries in order to avoid querying the database in a loop. In the first query two left outer joins are used to retrieve the the number of likes posts and topics created by this user have received. Another lengthy query is then used to get the rest of the required information. Separate joins were required to get the information about the creation of the topic, the information about the most recent post within the topic, the number of topic likes and number of post likes for all the topics which have been liked by the user. These results are then iterated through and added to the list of TopicSummaryViews.

\end{document}

